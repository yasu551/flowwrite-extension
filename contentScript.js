(()=>{function e(e){e.addEventListener("input",(t=>{t.target.value,async function(e,t){try{!function(e){let t=document.getElementById("flowwrite-suggestion-overlay");t||(t=document.createElement("div"),t.id="flowwrite-suggestion-overlay",t.style.position="absolute",t.style.zIndex=9999,t.style.pointerEvents="none",document.body.appendChild(t));const n=e.getBoundingClientRect(),o=function(e,t){const n=document.createElement("div"),o=window.getComputedStyle(e);n.style.position="absolute",n.style.visibility="hidden",n.style.whiteSpace="INPUT"===e.nodeName?"pre":"pre-wrap",n.style.wordWrap="break-word",["font-family","font-size","font-weight","font-style","letter-spacing","text-transform","word-spacing","text-indent","padding","border","box-sizing","line-height"].forEach((e=>{n.style[e]=o.getPropertyValue(e)})),n.style.width=o.width,n.textContent=e.value.substring(0,t);const l=document.createElement("span");l.textContent=e.value.substring(t)||".",n.appendChild(l),document.body.appendChild(n);const d={left:l.offsetLeft,top:l.offsetTop,height:l.offsetHeight};return document.body.removeChild(n),d}(e,e.selectionStart),l=n.left+window.scrollX+o.left,d=n.top+window.scrollY+o.top+o.height;t.style.left=`${l}px`,t.style.top=`${d}px`,t.style.width=`${n.width}px`,t.style.height=`${n.height}px`,t.textContent="サンプルの入力候補",t.style.color="gray"}(t)}catch(e){console.error("LLM suggestion error:",e)}}(0,e)}))}document.addEventListener("focusin",(t=>{const n=t.target;n&&("TEXTAREA"===n.nodeName||"INPUT"===n.nodeName&&"text"===n.type)&&(e(n),function(e){const t="flowwrite-polish-example-button-overlay";let n=document.getElementById(t);n||(n=document.createElement("div"),n.id=t,n.style.position="absolute",n.style.zIndex=9999,document.body.appendChild(n));const o="flowwrite-polish-example-button";let l=document.getElementById(o);l||(l=document.createElement("button"),l.id=o,l.textContent="校正例を表示",l.style.width="100px",l.style.height="30px",l.style.backgroundColor="#007bff",l.style.color="#fff",l.style.border="none",l.style.borderRadius="12px",l.addEventListener("click",(async()=>{e.value,chrome.runtime.sendMessage({type:"open_side_panel"},(e=>{console.log("Response from background:",e)}))})),n.appendChild(l));const d=e.getBoundingClientRect();n.style.left=d.left+d.width-110+"px",n.style.top=d.top+d.height-35+"px"}(n))})),document.addEventListener("focusout",(t=>{const n=t.target;n&&("TEXTAREA"===n.nodeName||"INPUT"===n.nodeName&&"text"===n.type)&&n.removeEventListener("input",e)})),document.addEventListener("keydown",(e=>{if("Tab"===e.key){const t=document.getElementById("flowwrite-suggestion-overlay");if(t&&t.textContent){const n=document.activeElement;!n||"TEXTAREA"!==n.nodeName&&"INPUT"!==n.nodeName||(n.value+=t.textContent,t.textContent="",e.preventDefault())}}})),document.addEventListener("keydown",(async e=>{const t=document.activeElement;if(t&&("TEXTAREA"===t.nodeName||"INPUT"===t.nodeName)&&"Tab"===e.key&&e.metaKey){e.preventDefault();const n=t.value;!function(e,t){let n=document.getElementById("flowwrite-polish-popup");n||(n=document.createElement("div"),n.id="flowwrite-polish-popup",n.style.position="absolute",n.style.zIndex=9999,n.style.border="1px solid #ccc",n.style.backgroundColor="#fff",document.body.appendChild(n));const o=e.getBoundingClientRect();n.style.left=`${o.left+window.scrollX}px`,n.style.top=`${o.top+window.scrollY+o.height+5}px`,n.innerText=t;const l=o=>{"Tab"===o.key&&o.metaKey&&(e.value=t,n.remove(),document.removeEventListener("keydown",l),o.preventDefault())};document.addEventListener("keydown",l)}(t,await async function(e){try{return"校正後の例文です。"}catch(t){return console.error("LLM polishing error:",t),e}}(n))}}))})();